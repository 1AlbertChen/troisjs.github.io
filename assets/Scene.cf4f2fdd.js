import{q as e,n as t}from"./app.00b2ff10.js";import{V as r,s as n,ah as o,ai as i,aj as a,ak as s,w as c,m}from"./OrbitControls.97338009.js";function h(){const e={canvas:null,antialias:!0,alpha:!1,autoClear:!0,orbit_ctrl:!1,mouse_move:!1,mouse_raycast:!1,mouse_over:!1,click:!1,resize:!0,width:0,height:0},t={width:1,height:1,wWidth:1,wHeight:1,ratio:1},c=[];let m=[],h=[];const l=new r,d=new n,u=new o(new n(0,0,1),0),f=new i,v=[],p={conf:e,renderer:null,camera:null,cameraCtrl:null,materials:{},scene:null,size:t,mouse:l,mouseV3:d,init:function(t){t&&Object.entries(t).forEach((([t,r])=>{e[t]=r}));if(!p.scene)return void console.error("Missing Scene");if(!p.camera)return void console.error("Missing Camera");p.renderer=new a({canvas:e.canvas,antialias:e.antialias,alpha:e.alpha}),p.renderer.autoClear=e.autoClear,e.orbit_ctrl&&(p.orbitCtrl=new s(p.camera,p.renderer.domElement),e.orbit_ctrl instanceof Object&&Object.entries(e.orbit_ctrl).forEach((([e,t])=>{p.orbitCtrl[e]=t})));e.resize?(E(),window.addEventListener("resize",E)):k(300|e.width,150|e.height);e.mouse_move=e.mouse_move||e.mouse_over,e.mouse_move&&("body"===e.mouse_move?p.mouse_move_element=document.body:p.mouse_move_element=p.renderer.domElement,p.mouse_move_element.addEventListener("mousemove",_),p.mouse_move_element.addEventListener("mouseleave",g));e.click&&p.renderer.domElement.addEventListener("click",w);return c.forEach((e=>e())),!0},dispose:function(){h=[],window.removeEventListener("resize",E),p.mouse_move_element&&(p.mouse_move_element.removeEventListener("mousemove",_),p.mouse_move_element.removeEventListener("mouseleave",g));p.renderer.domElement.removeEventListener("click",w),p.orbitCtrl&&p.orbitCtrl.dispose();this.renderer.dispose()},render:function(){p.orbitCtrl&&p.orbitCtrl.update();h.forEach((e=>e())),p.renderer.render(p.scene,p.camera)},renderC:function(){p.orbitCtrl&&p.orbitCtrl.update();h.forEach((e=>e())),p.composer.render()},setSize:k,onAfterInit:function(e){c.push(e)},onAfterResize:function(e){m.push(e)},offAfterResize:function(e){m=m.filter((t=>t!==e))},onBeforeRender:function(e){h.push(e)},offBeforeRender:function(e){h=h.filter((t=>t!==e))},addIntersectObject:function(e){-1===v.indexOf(e)&&v.push(e)},removeIntersectObject:function(e){const t=v.indexOf(e);-1!==t&&v.splice(t,1)}};function b(e){const r=e.target.getBoundingClientRect();l.x=(e.clientX-r.left)/t.width*2-1,l.y=-(e.clientY-r.top)/t.height*2+1}function w(e){b(e),f.setFromCamera(l,p.camera);const t=f.intersectObjects(v);for(let r=0;r<t.length;r++){const n=t[r].object;n.onClick&&n.onClick(e)}}function _(e){b(e),C()}function g(e){C()}function C(t){if((e.mouse_over||e.mouse_raycast)&&(f.setFromCamera(l,p.camera),e.mouse_raycast&&(p.camera.getWorldDirection(u.normal),u.normal.normalize(),f.ray.intersectPlane(u,d)),e.mouse_over)){const e=f.intersectObjects(v),t=[...v];for(let r=0;r<e.length;r++){const n=e[r].object;!n.hover&&n.onHover&&(n.hover=!0,n.onHover(!0)),t.splice(t.indexOf(n),1)}for(let r=0;r<t.length;r++){const e=t[r];e.hover&&e.onHover&&(e.hover=!1,e.onHover(!1))}}}function E(){if("window"===e.resize)k(window.innerWidth,window.innerHeight);else{const e=p.renderer.domElement.parentNode;k(e.clientWidth,e.clientHeight)}m.forEach((e=>e()))}function k(e,r){if(t.width=e,t.height=r,t.ratio=e/r,p.renderer.setSize(e,r,!1),p.camera.aspect=t.ratio,p.camera.updateProjectionMatrix(),p.composer&&p.composer.setSize(e,r),"OrthographicCamera"===p.camera.type)t.wWidth=p.camera.right-p.camera.left,t.wHeight=p.camera.top-p.camera.bottom;else{const e=function(){const e=p.camera.fov*Math.PI/180,t=2*Math.tan(e/2)*Math.abs(p.camera.position.z);return[t*p.camera.aspect,t]}();t.wWidth=e[0],t.wHeight=e[1]}}return p}var l={name:"Renderer",props:{antialias:Boolean,alpha:Boolean,autoClear:{type:Boolean,default:!0},mouseMove:{type:[Boolean,String],default:!1},mouseRaycast:{type:Boolean,default:!1},mouseOver:{type:Boolean,default:!1},click:{type:Boolean,default:!1},orbitCtrl:{type:[Boolean,Object],default:!1},resize:{type:[Boolean,String],default:!1},shadow:Boolean,width:String,height:String},setup:()=>({three:h(),raf:!0,onMountedCallbacks:[]}),provide(){return{three:this.three,rendererComponent:this}},mounted(){const e={canvas:this.$el,antialias:this.antialias,alpha:this.alpha,autoClear:this.autoClear,orbit_ctrl:this.orbitCtrl,mouse_move:this.mouseMove,mouse_raycast:this.mouseRaycast,mouse_over:this.mouseOver,click:this.click,resize:this.resize,width:this.width,height:this.height};this.three.init(e)&&(this.renderer=this.three.renderer,this.renderer.shadowMap.enabled=this.shadow,this.three.composer?this.animateC():this.animate()),this.onMountedCallbacks.forEach((e=>e()))},beforeUnmount(){this.raf=!1,this.three.dispose()},methods:{onMounted(e){this.onMountedCallbacks.push(e)},onBeforeRender(e){this.three.onBeforeRender(e)},onAfterResize(e){this.three.onAfterResize(e)},animate(){this.raf&&requestAnimationFrame(this.animate),this.three.render()},animateC(){this.raf&&requestAnimationFrame(this.animateC),this.three.renderC()}},render(){return e("canvas",{},this.$slots.default())},__hmrId:"Renderer"},d={name:"Scene",inject:["three"],props:{id:String,background:[String,Number]},setup(e){const r=new c;return e.background&&(r.background=new m(e.background)),t((()=>e.background),(e=>{r.background=new m(e)})),{scene:r}},provide(){return{scene:this.scene}},mounted(){this.three.scene||(this.three.scene=this.scene)},methods:{add(e){this.scene.add(e)},remove(e){this.scene.remove(e)}},render(){return this.$slots.default?this.$slots.default():[]},__hmrId:"Scene"};export{l as R,d as S};
